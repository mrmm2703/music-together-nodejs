"use strict";function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}function _createClass(o,e,n){return e&&_defineProperties(o.prototype,e),n&&_defineProperties(o,n),o}var db_config=require("./db_config"),mysql=require("mysql"),DatabasePool=function(){function o(){_classCallCheck(this,o),this.pool=mysql.createPool({connectionLimit:100,host:db_config.host,user:db_config.username,password:db_config.password,database:db_config.database,charset:"utf8mb4"})}return _createClass(o,[{key:"insertGroupLog",value:function(n,a,s){var o=mysql.format("INSERT INTO groupLogs (glogSpotifyID, glogGroupID, glogAction) VALUES (?,?,?)",[n,a,s]);this.pool.query(o,function(o,e){o?(console.error("DatabasePool::insertGroupLog(".concat(n,", ").concat(a,", ").concat(s,")")),console.error(o)):console.log("DatabasePool::insertGroupLog(".concat(n,", ").concat(a,", ").concat(s,") - SUCCESS"))})}},{key:"updateUserGroupId",value:function(n,a){var o=mysql.format("UPDATE users SET userGroupID=? WHERE userSpotifyID=?",[a,n]);this.pool.query(o,function(o,e){o?(console.error("DatabasePool::updateUserGroupId(".concat(n,", ").concat(a,")")),console.error(o)):console.log("DatabasePool::updateUserGroupId(".concat(n,", ").concat(a,") - SUCCESS"))})}},{key:"getBannedWords",value:function(){var a=[];return this.pool.query("SELECT word FROM bannedWords",function(o,e){if(o)console.log("DatabasePool::getBannedWords()"),console.log(o);else{console.log("DatabasePool::getBannedWords() - SUCCESS");for(var n=0;n<e.length;n++)a.push(e[n].word)}}),a}},{key:"getRecentBannedWords",value:function(s,c){var t=this;return new Promise(function(n,a){var o="SELECT COUNT(*) FROM bannedWordsUse WHERE banUsgDate "+">= DATE_ADD(CURRENT_DATE(), INTERVAL -".concat(c," HOUR) AND banUsgSenderID = ?"),e=mysql.format(o,[s]);t.pool.query(e,function(o,e){o?(console.log("DatabasePool::getRecentBannedWords(".concat(s,", ").concat(c,")")),console.log(o),a(o)):(console.log(e),n(e[0]["COUNT(*)"]))})})}},{key:"logBannedWord",value:function(n,a,s,c){var t,r=this,l="INSERT INTO messages (msgSenderID, msgContent, msgGroupID) VALUES (?,?,?)",u=mysql.format(l,[a,c,s]);this.pool.query(u,function(o,e){o?(console.log("DatabasePool::logBannedWord[msg](".concat(c,", ").concat(a,", ").concat(s,")")),console.log(o)):(console.log("DatabasePool::logBannedWord[msg](".concat(c,", ").concat(a,", ").concat(s,") - SUCCESS")),console.log(e.insertId),t=e.insertId,l="INSERT INTO bannedWordsUse (banUsgWordID, banUsgSenderID, banUsgGroupID, banUsgMsgID) VALUES ((SELECT wordID FROM bannedWords WHERE word=?), ?, ?, ?)",u=mysql.format(l,[n,a,s,t]),r.pool.query(u,function(o,e){o?(console.error("DatabasePool::logBannedWord(".concat(n,", ").concat(a,", ").concat(s,", ").concat(t,")")),console.error(o)):console.error("DatabasePool::logBannedWord(".concat(n,", ").concat(a,", ").concat(s,", ").concat(t,") - SUCCESS"))}))})}},{key:"logMessage",value:function(n,a,s){var o=mysql.format("INSERT INTO messages (msgSenderID, msgContent, msgGroupID) VALUES (?,?,?)",[a,n,s]),c="poop";return this.pool.query(o,function(o,e){o?(console.log("DatabasePool::logMessage(".concat(n,", ").concat(a,", ").concat(s,")")),console.log(o)):(console.log("DatabasePool::logMessage(".concat(n,", ").concat(a,", ").concat(s,") - SUCCESS")),console.log(e.insertId),c=e.insertId)}),c}},{key:"banUser",value:function(n){var o=mysql.format("UPDATE users SET userBanned = 1 WHERE userSpotifyID=?",[n]);this.pool.query(o,function(o,e){return!o||(console.log("DatabasePool::banUser(".concat(n,")")),void console.log(o))})}},{key:"checkAccessToken",value:function(n,a){var o=mysql.format("SELECT COUNT(adminID) AS 'count' FROM adminUsers WHERE adminToken=?",[n]);this.pool.query(o,function(o,e){o?(console.log("DatabasePool::checkAccessToken(".concat(n,")")),console.log(o),a(!1)):(console.log("DatabasePool::checkAccessToken(".concat(n,")")),1==e.length?a(!0):a(!1))})}}]),o}();module.exports=DatabasePool;